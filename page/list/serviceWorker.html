<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="keywords" content="前端一锅煮,serviceWorker 实战"><link rel="icon" href="/img/logo.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileColor" content="#000000"><title>serviceWorker 实战 | 前端一锅煮</title><meta name="description" content="serviceWorker 实战">
    <link rel="modulepreload" href="/blog/assets/app.6da7124e.js"><link rel="modulepreload" href="/blog/assets/serviceWorker.html.c831498e.js"><link rel="modulepreload" href="/blog/assets/serviceWorker.html.4000b715.js"><link rel="prefetch" href="/blog/assets/index.html.6d01a2cb.js"><link rel="prefetch" href="/blog/assets/index.html.c356b4a5.js"><link rel="prefetch" href="/blog/assets/cola.html.e4806231.js"><link rel="prefetch" href="/blog/assets/quick_app.html.fe111499.js"><link rel="prefetch" href="/blog/assets/webview.html.8973f23c.js"><link rel="prefetch" href="/blog/assets/add.html.6ca15e66.js"><link rel="prefetch" href="/blog/assets/base_summary.html.110ffd64.js"><link rel="prefetch" href="/blog/assets/fn.html.470922ad.js"><link rel="prefetch" href="/blog/assets/promise_all.html.503af5ab.js"><link rel="prefetch" href="/blog/assets/prototype.html.c216cc4e.js"><link rel="prefetch" href="/blog/assets/three.html.c55c611a.js"><link rel="prefetch" href="/blog/assets/bfc.html.12f2f1e5.js"><link rel="prefetch" href="/blog/assets/css_layout_two.html.ba63e39b.js"><link rel="prefetch" href="/blog/assets/ai.html.8d3a8611.js"><link rel="prefetch" href="/blog/assets/index.html.f249b277.js"><link rel="prefetch" href="/blog/assets/aglie.html.f8897adf.js"><link rel="prefetch" href="/blog/assets/app.html.4b9ec687.js"><link rel="prefetch" href="/blog/assets/code_review.html.bc3a99c0.js"><link rel="prefetch" href="/blog/assets/confidence.html.0d77def2.js"><link rel="prefetch" href="/blog/assets/discipline.html.12aa4483.js"><link rel="prefetch" href="/blog/assets/feday.html.43f3a4ee.js"><link rel="prefetch" href="/blog/assets/love.html.2dcaf6fa.js"><link rel="prefetch" href="/blog/assets/money_rate.html.280fa8d1.js"><link rel="prefetch" href="/blog/assets/need_work.html.9fd86d8c.js"><link rel="prefetch" href="/blog/assets/plan.html.55213dc7.js"><link rel="prefetch" href="/blog/assets/soul.html.768e71af.js"><link rel="prefetch" href="/blog/assets/think.html.70b05155.js"><link rel="prefetch" href="/blog/assets/time.html.79f32616.js"><link rel="prefetch" href="/blog/assets/index.html.11af586a.js"><link rel="prefetch" href="/blog/assets/emoji.html.b9989d2d.js"><link rel="prefetch" href="/blog/assets/es6.html.13ed4360.js"><link rel="prefetch" href="/blog/assets/fe.html.3b3d8617.js"><link rel="prefetch" href="/blog/assets/fe_design.html.d5b0b873.js"><link rel="prefetch" href="/blog/assets/fe_server_check.html.4d7b9142.js"><link rel="prefetch" href="/blog/assets/fe_server_name.html.752ce7ca.js"><link rel="prefetch" href="/blog/assets/fe_up.html.29040e77.js"><link rel="prefetch" href="/blog/assets/npm.html.e72aa54c.js"><link rel="prefetch" href="/blog/assets/npm_run.html.98aaa461.js"><link rel="prefetch" href="/blog/assets/project_template.html.288c3dcc.js"><link rel="prefetch" href="/blog/assets/sh.html.5f1c0c24.js"><link rel="prefetch" href="/blog/assets/source_link.html.e2fe27e1.js"><link rel="prefetch" href="/blog/assets/sso.html.1d80181a.js"><link rel="prefetch" href="/blog/assets/ts.html.cd7c6443.js"><link rel="prefetch" href="/blog/assets/underline.html.4767bdd2.js"><link rel="prefetch" href="/blog/assets/updateService.html.e5b5e0fd.js"><link rel="prefetch" href="/blog/assets/webpack4.html.ad53dad8.js"><link rel="prefetch" href="/blog/assets/http.html.c0b3835f.js"><link rel="prefetch" href="/blog/assets/loop.html.7ee50776.js"><link rel="prefetch" href="/blog/assets/onion.html.0b6e071f.js"><link rel="prefetch" href="/blog/assets/perf.html.e8293673.js"><link rel="prefetch" href="/blog/assets/power.html.8c0a01bb.js"><link rel="prefetch" href="/blog/assets/process.html.621f9d31.js"><link rel="prefetch" href="/blog/assets/security.html.80097fc7.js"><link rel="prefetch" href="/blog/assets/v8.html.ea1267dc.js"><link rel="prefetch" href="/blog/assets/hb.html.183ccde9.js"><link rel="prefetch" href="/blog/assets/read.html.83444f6d.js"><link rel="prefetch" href="/blog/assets/mac.html.c363b9d0.js"><link rel="prefetch" href="/blog/assets/mac_down.html.4d7a51b5.js"><link rel="prefetch" href="/blog/assets/maclist.html.7fcc92e6.js"><link rel="prefetch" href="/blog/assets/vscode.html.35f0b950.js"><link rel="prefetch" href="/blog/assets/vue_reload.html.50a70fdb.js"><link rel="prefetch" href="/blog/assets/vue_ui_contrast.html.c0f397da.js"><link rel="prefetch" href="/blog/assets/api.html.3ccaacf2.js"><link rel="prefetch" href="/blog/assets/config.html.4b16ab9d.js"><link rel="prefetch" href="/blog/assets/guide.html.f8df3fc6.js"><link rel="prefetch" href="/blog/assets/theme.html.a17dc900.js"><link rel="prefetch" href="/blog/assets/404.html.ab74ef0a.js"><link rel="prefetch" href="/blog/assets/index.html.0888740a.js"><link rel="prefetch" href="/blog/assets/index.html.ccc41012.js"><link rel="prefetch" href="/blog/assets/cola.html.8bdcad90.js"><link rel="prefetch" href="/blog/assets/quick_app.html.369ea008.js"><link rel="prefetch" href="/blog/assets/webview.html.4d28ba0d.js"><link rel="prefetch" href="/blog/assets/add.html.35f80863.js"><link rel="prefetch" href="/blog/assets/base_summary.html.908bfee7.js"><link rel="prefetch" href="/blog/assets/fn.html.ef8c25e1.js"><link rel="prefetch" href="/blog/assets/promise_all.html.7cc3c39b.js"><link rel="prefetch" href="/blog/assets/prototype.html.f3efd717.js"><link rel="prefetch" href="/blog/assets/three.html.62508157.js"><link rel="prefetch" href="/blog/assets/bfc.html.378b7eb8.js"><link rel="prefetch" href="/blog/assets/css_layout_two.html.4236999d.js"><link rel="prefetch" href="/blog/assets/ai.html.e4065256.js"><link rel="prefetch" href="/blog/assets/index.html.e4ef4543.js"><link rel="prefetch" href="/blog/assets/aglie.html.e7dccfaf.js"><link rel="prefetch" href="/blog/assets/app.html.b2b12e5c.js"><link rel="prefetch" href="/blog/assets/code_review.html.2cf45649.js"><link rel="prefetch" href="/blog/assets/confidence.html.44a61c4b.js"><link rel="prefetch" href="/blog/assets/discipline.html.15f00bd9.js"><link rel="prefetch" href="/blog/assets/feday.html.f553c0b8.js"><link rel="prefetch" href="/blog/assets/love.html.3a5a52d3.js"><link rel="prefetch" href="/blog/assets/money_rate.html.b84ac952.js"><link rel="prefetch" href="/blog/assets/need_work.html.f96a41de.js"><link rel="prefetch" href="/blog/assets/plan.html.843657a6.js"><link rel="prefetch" href="/blog/assets/soul.html.cfb53fae.js"><link rel="prefetch" href="/blog/assets/think.html.1c980e83.js"><link rel="prefetch" href="/blog/assets/time.html.ae37d48b.js"><link rel="prefetch" href="/blog/assets/index.html.32c2cb21.js"><link rel="prefetch" href="/blog/assets/emoji.html.9f90cc4b.js"><link rel="prefetch" href="/blog/assets/es6.html.19402800.js"><link rel="prefetch" href="/blog/assets/fe.html.829d0ed8.js"><link rel="prefetch" href="/blog/assets/fe_design.html.0ebf9f0f.js"><link rel="prefetch" href="/blog/assets/fe_server_check.html.4683b7b1.js"><link rel="prefetch" href="/blog/assets/fe_server_name.html.4509d936.js"><link rel="prefetch" href="/blog/assets/fe_up.html.dbd34ebc.js"><link rel="prefetch" href="/blog/assets/npm.html.18fcb0c1.js"><link rel="prefetch" href="/blog/assets/npm_run.html.e7bf9355.js"><link rel="prefetch" href="/blog/assets/project_template.html.9d409a08.js"><link rel="prefetch" href="/blog/assets/sh.html.3eac8d25.js"><link rel="prefetch" href="/blog/assets/source_link.html.ddd0787b.js"><link rel="prefetch" href="/blog/assets/sso.html.1c880d53.js"><link rel="prefetch" href="/blog/assets/ts.html.14acd559.js"><link rel="prefetch" href="/blog/assets/underline.html.89d47386.js"><link rel="prefetch" href="/blog/assets/updateService.html.c0e25538.js"><link rel="prefetch" href="/blog/assets/webpack4.html.fbb2a1be.js"><link rel="prefetch" href="/blog/assets/http.html.bade9cd1.js"><link rel="prefetch" href="/blog/assets/loop.html.6be584fc.js"><link rel="prefetch" href="/blog/assets/onion.html.7057f780.js"><link rel="prefetch" href="/blog/assets/perf.html.c6e11b1b.js"><link rel="prefetch" href="/blog/assets/power.html.600609ae.js"><link rel="prefetch" href="/blog/assets/process.html.ce6edbf4.js"><link rel="prefetch" href="/blog/assets/security.html.d44ee077.js"><link rel="prefetch" href="/blog/assets/v8.html.a2ea5e36.js"><link rel="prefetch" href="/blog/assets/hb.html.a487989f.js"><link rel="prefetch" href="/blog/assets/read.html.69d44037.js"><link rel="prefetch" href="/blog/assets/mac.html.66f12713.js"><link rel="prefetch" href="/blog/assets/mac_down.html.cf3721e9.js"><link rel="prefetch" href="/blog/assets/maclist.html.282230ed.js"><link rel="prefetch" href="/blog/assets/vscode.html.a96c48ed.js"><link rel="prefetch" href="/blog/assets/vue_reload.html.79fd663c.js"><link rel="prefetch" href="/blog/assets/vue_ui_contrast.html.44daba36.js"><link rel="prefetch" href="/blog/assets/api.html.f52ab485.js"><link rel="prefetch" href="/blog/assets/config.html.5ee8988d.js"><link rel="prefetch" href="/blog/assets/guide.html.7d6e4938.js"><link rel="prefetch" href="/blog/assets/theme.html.ada8587b.js"><link rel="prefetch" href="/blog/assets/404.html.fa4ec67a.js"><link rel="prefetch" href="/blog/assets/404.389b8e98.js"><link rel="prefetch" href="/blog/assets/Layout.bbf94219.js"><link rel="prefetch" href="/blog/assets/vEmoji.f4f2da1c.js"><link rel="prefetch" href="/blog/assets/vHome.915a7d14.js"><link rel="prefetch" href="/blog/assets/vLife.c0039bb2.js"><link rel="prefetch" href="/blog/assets/vList.efc7a95f.js"><link rel="prefetch" href="/blog/assets/index.0e8935cb.js">
    <link rel="stylesheet" href="/blog/assets/style.04020ca0.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><!----><span class="site-name can-hide">前端一锅煮</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/page/list/" class="router-link-active" aria-label="技术文章"><!--[--><!--]--> 技术文章 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/page/life/" class="" aria-label="生活感悟"><!--[--><!--]--> 生活感悟 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/page/about/" class="" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="VuePress笔记"><span class="title">VuePress笔记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="VuePress笔记"><span class="title">VuePress笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/page/vuepress/guide" class="" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/page/vuepress/api" class="" aria-label="语法"><!--[--><!--]--> 语法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/page/vuepress/config" class="" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/page/vuepress/theme" class="" aria-label="主题"><!--[--><!--]--> 主题 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/cjm0/blog.git" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/page/list/" class="router-link-active" aria-label="技术文章"><!--[--><!--]--> 技术文章 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/page/life/" class="" aria-label="生活感悟"><!--[--><!--]--> 生活感悟 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/page/about/" class="" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="VuePress笔记"><span class="title">VuePress笔记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="VuePress笔记"><span class="title">VuePress笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/page/vuepress/guide" class="" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/page/vuepress/api" class="" aria-label="语法"><!--[--><!--]--> 语法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/page/vuepress/config" class="" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/page/vuepress/theme" class="" aria-label="主题"><!--[--><!--]--> 主题 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/cjm0/blog.git" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">serviceWorker 实战 <!----></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#用-serviceworker-做了什么事情" class="router-link-active router-link-exact-active sidebar-item" aria-label="用 serviceWorker 做了什么事情"><!--[--><!--]--> 用 serviceWorker 做了什么事情 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#serviceworker-介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="serviceWorker 介绍"><!--[--><!--]--> serviceWorker 介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#serviceworker-是-pwa-重要的一部分" class="router-link-active router-link-exact-active sidebar-item" aria-label="serviceWorker 是 PWA 重要的一部分"><!--[--><!--]--> serviceWorker 是 PWA 重要的一部分 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#serviceworker-特性" class="router-link-active router-link-exact-active sidebar-item" aria-label="serviceWorker 特性"><!--[--><!--]--> serviceWorker 特性 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#为什么用-serviceworker" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么用 serviceWorker"><!--[--><!--]--> 为什么用 serviceWorker <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#后端接口缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="后端接口缓存"><!--[--><!--]--> 后端接口缓存 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#浏览器自带缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="浏览器自带缓存"><!--[--><!--]--> 浏览器自带缓存 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#为什么用-serviceworker-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么用 serviceWorker"><!--[--><!--]--> 为什么用 serviceWorker <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#serviceworker-怎么用" class="router-link-active router-link-exact-active sidebar-item" aria-label="serviceWorker 怎么用"><!--[--><!--]--> serviceWorker 怎么用 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#serviceworker-作用域" class="router-link-active router-link-exact-active sidebar-item" aria-label="serviceWorker 作用域"><!--[--><!--]--> serviceWorker 作用域 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#指定作用域-scope-read-区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="指定作用域 scope / ./ /read/ 区别"><!--[--><!--]--> 指定作用域 scope / ./ /read/ 区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#作用域污染" class="router-link-active router-link-exact-active sidebar-item" aria-label="作用域污染"><!--[--><!--]--> 作用域污染 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#为什么放在-window-onload-内执行" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么放在 window.onload 内执行？"><!--[--><!--]--> 为什么放在 window.onload 内执行？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#安装激活" class="router-link-active router-link-exact-active sidebar-item" aria-label="安装激活"><!--[--><!--]--> 安装激活 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#拦截请求" class="router-link-active router-link-exact-active sidebar-item" aria-label="拦截请求"><!--[--><!--]--> 拦截请求 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#缓存策略" class="router-link-active router-link-exact-active sidebar-item" aria-label="缓存策略"><!--[--><!--]--> 缓存策略 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#fetch-请求拦截" class="router-link-active router-link-exact-active sidebar-item" aria-label="fetch 请求拦截"><!--[--><!--]--> fetch 请求拦截 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#serviceworker" class="router-link-active router-link-exact-active sidebar-item" aria-label="serviceWorker"><!--[--><!--]--> serviceWorker <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#cache-缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="cache 缓存"><!--[--><!--]--> cache 缓存 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#缓存的资源" class="router-link-active router-link-exact-active sidebar-item" aria-label="缓存的资源"><!--[--><!--]--> 缓存的资源 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#serviceworker-怎么更新" class="router-link-active router-link-exact-active sidebar-item" aria-label="serviceWorker 怎么更新"><!--[--><!--]--> serviceWorker 怎么更新 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#waituntil" class="router-link-active router-link-exact-active sidebar-item" aria-label="waitUntil()"><!--[--><!--]--> waitUntil() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#skipwaiting" class="router-link-active router-link-exact-active sidebar-item" aria-label="skipWaiting()"><!--[--><!--]--> skipWaiting() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#claim" class="router-link-active router-link-exact-active sidebar-item" aria-label="claim()"><!--[--><!--]--> claim() <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/page/list/serviceWorker.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="serviceworker-实战" tabindex="-1"><a class="header-anchor" href="#serviceworker-实战" aria-hidden="true">#</a> serviceWorker 实战</h1><ul><li><p>用 serviceWorker 做了什么事情</p></li><li><p>serviceWorker 介绍</p></li><li><p>为什么用 serviceWorker</p></li><li><p>serviceWorker 怎么用</p></li><li><p>总结</p></li></ul><h2 id="用-serviceworker-做了什么事情" tabindex="-1"><a class="header-anchor" href="#用-serviceworker-做了什么事情" aria-hidden="true">#</a> 用 serviceWorker 做了什么事情</h2><p>小说阅读器页面以及资源缓存</p><p>加缓存之前：浏览器非首次跳阅读器 -&gt; 请求网络资源 -&gt; 渲染展示</p><p>加缓存之后：浏览器非首次跳阅读器 -&gt; 直接从缓存取资源 -&gt; 渲染展示</p><p><img src="https://pic4.zhimg.com/80/v2-24d2b784e2d1d56b7bc9dc61faab340f_1440w.webp" alt="4.png"></p><p><img src="https://pic1.zhimg.com/80/v2-63577a8206ed2c8ef3f985d9a2705b18_1440w.webp" alt="5.png"></p><h2 id="serviceworker-介绍" tabindex="-1"><a class="header-anchor" href="#serviceworker-介绍" aria-hidden="true">#</a> serviceWorker 介绍</h2><h2 id="serviceworker-是-pwa-重要的一部分" tabindex="-1"><a class="header-anchor" href="#serviceworker-是-pwa-重要的一部分" aria-hidden="true">#</a> serviceWorker 是 PWA 重要的一部分</h2><p>PWA：Progressive Web App, 渐进式增强 WEB 应用，包含以下几种技术：</p><ol><li><p>App Manifest 网页加桌</p></li><li><p>Service Worker 缓存</p></li><li><p>Cache API、IndexedDB 离线缓存</p></li><li><p>Notifications API 通知</p></li><li><p>Push API 推送</p></li><li><p>Background Sync 后台同步（关闭网页后仍可发送请求，无网下维持请求待联网后请求）</p></li></ol><h3 id="serviceworker-特性" tabindex="-1"><a class="header-anchor" href="#serviceworker-特性" aria-hidden="true">#</a> serviceWorker 特性</h3><ol><li><p>浏览器在后台运行的事件驱动 worker 脚本</p></li><li><p>worker: 无法访问 DOM，不会对主进程造成阻塞，支持 indexedDB、postMessage</p></li><li><p>有自己的生命周期：下载、安装、激活</p></li><li><p>可以在浏览器和网络之间建立一个中间层，拦截和处理网络请求</p></li><li><p>激活后可以拦截网络请求并返回缓存的响应，从而细粒度地控制缓存资源</p></li><li><p>只能用在在 https 域名下，本地开发可以用 http:localhost 或者 http://127.0.0.1</p></li></ol><h2 id="为什么用-serviceworker" tabindex="-1"><a class="header-anchor" href="#为什么用-serviceworker" aria-hidden="true">#</a> 为什么用 serviceWorker</h2><h3 id="后端接口缓存" tabindex="-1"><a class="header-anchor" href="#后端接口缓存" aria-hidden="true">#</a> 后端接口缓存</h3><p>HTTP 协议可以定义一个响应资源应该何时、如何被缓存以及缓存多长时间</p><p>后端接口返回对应相应头给到浏览器，浏览器根据相应规则去缓存对应资源</p><p><img src="https://pic2.zhimg.com/80/v2-59567d126d65d67a83a53c41160014b5_1440w.webp" alt="6.png"></p><p><img src="https://pic3.zhimg.com/80/v2-455674142119b1799e763643de45171e_1440w.webp" alt="7.png"></p><h3 id="浏览器自带缓存" tabindex="-1"><a class="header-anchor" href="#浏览器自带缓存" aria-hidden="true">#</a> 浏览器自带缓存</h3><p>浏览器会把请求过的资源放在内存、硬盘中缓存起来</p><p>重复刷新网站会直接用缓存资源</p><p><img src="https://pic4.zhimg.com/80/v2-0d750312425cc4ed846cc33a212ac8cb_1440w.webp" alt="8.png"></p><h3 id="为什么用-serviceworker-1" tabindex="-1"><a class="header-anchor" href="#为什么用-serviceworker-1" aria-hidden="true">#</a> 为什么用 serviceWorker</h3><p>接口缓存由后端根据实际情况去加缓存策略；</p><ul><li><p>Nginx 静态资源缓存需要写死在 nginx 配置里，不够灵活；</p></li><li><p>浏览器自带缓存未提供控制接口，无法自由控制；</p></li><li><p>serviceWorker 提供完整的编程接口和监听事件，可自由发挥实现任意资源的缓存， 灵活可控。</p></li></ul><h2 id="serviceworker-怎么用" tabindex="-1"><a class="header-anchor" href="#serviceworker-怎么用" aria-hidden="true">#</a> serviceWorker 怎么用</h2><p><img src="https://pic2.zhimg.com/80/v2-1df066e43554658cf5e0bf9b239e5d3d_1440w.webp" alt="9.png"></p><h3 id="serviceworker-作用域" tabindex="-1"><a class="header-anchor" href="#serviceworker-作用域" aria-hidden="true">#</a> serviceWorker 作用域</h3><ol><li>serviceWorker 默认作用域就是注册时候的 path</li></ol><ul><li>举例1：serviceWorker 注册的 path 为 http://127.0.0.1:8005/sw.js，则 scope 默认为 /</li><li>举例2：serviceWorker 注册的 path 为 http://127.0.0.1:8005/sw.js/read/sw.js，则 scope 默认为 /read/</li></ul><ol start="2"><li>可以通过 register() 中传入 {scope: &#39;/read/&#39;} 指定作用域，指定作用域不允许超过最大作用域范围（注册 path）</li></ol><ul><li>举例1：注册 path 为 http://127.0.0.1:8005/sw.js，则 scope 可传任意目录</li><li>举例2：注册 path 为 http://127.0.0.1:8005/read/sw.js，则 scope 可传 /read/ /read/a/，不可传 /read2/</li></ul><p>建议：注册 path 为根目录，根据需要指定 scope 参数</p><p>举例：相同域名的独立子站：https://xxx/a 和 https://xxx/b 是两个站点</p><h3 id="指定作用域-scope-read-区别" tabindex="-1"><a class="header-anchor" href="#指定作用域-scope-read-区别" aria-hidden="true">#</a> 指定作用域 scope / ./ /read/ 区别</h3><ol><li>/ 根目录</li></ol><p>serviceWorker http://127.0.0.1:8005/ 可控制域名下所有页面（控制：可以处理这些页面里面的资源请求和网络请求）</p><p>http://127.0.0.1:8005/read/22324417000586202 ✅</p><p>http://127.0.0.1:8005/blank/22324417000586202 ✅</p><p>http://127.0.0.1:8005/read ✅</p><p>http://127.0.0.1:8005 ✅</p><ol start="2"><li>/read/ 指定目录</li></ol><p>serviceWorker http://127.0.0.1:8005/read/ 可控制 read 目录下所有页面</p><p>http://127.0.0.1:8005/read/22324417000586202 ✅</p><p>http://127.0.0.1:8005/blank/22324417000586202 ❎</p><p>http://127.0.0.1:8005/read ✅</p><p>http://127.0.0.1:8005 ❎</p><ol start="3"><li>./ 当前访问目录</li></ol><p>产生多个 serviceWorker</p><p>http://127.0.0.1:8005/read/22324417000586202 serviceWorker http://127.0.0.1:8005/read/</p><p>http://127.0.0.1:8005/blank/22324417000586202 serviceWorker http://127.0.0.1:8005/blank/</p><p>http://127.0.0.1:8005/read serviceWorker http://127.0.0.1:8005/</p><p>http://127.0.0.1:8005 serviceWorker http://127.0.0.1:8005/</p><p><img src="https://pic1.zhimg.com/80/v2-5df6a6d67bae67f3b40ec3d70f371c60_1440w.webp" alt="15.png"></p><h3 id="作用域污染" tabindex="-1"><a class="header-anchor" href="#作用域污染" aria-hidden="true">#</a> 作用域污染</h3><p>多个 serviceWorker 会产生作用域污染，即一个页面被多个 serviceWorker 控制。</p><p>Devtools 中，可以手动清除指定的 serviceWorker，在线上环境已经安装了如何处理？</p><p>可以先注销掉错误的 serviceWorker 再注册新的。</p><p><img src="https://pic3.zhimg.com/80/v2-f5394a839b99a378a24e3afb7627c7a2_1440w.webp" alt="16.png"></p><h3 id="为什么放在-window-onload-内执行" tabindex="-1"><a class="header-anchor" href="#为什么放在-window-onload-内执行" aria-hidden="true">#</a> 为什么放在 window.onload 内执行？</h3><ol><li><p>启动这个额外的线程会增加对 CPU 时间和内存的争用</p></li><li><p>如果该线程不是空闲的，会争用网络下载资源，不要通过同时下载次要资源来破坏关键资源。参考文章：https://web.dev/service-workers-registration</p></li><li><p>serviceWorker 第1次注册并不会拦截 fetch 请求</p></li></ol><p>为什么第1次注册不拦截 fetch 请求？</p><p>因为在 serviceWorker 的注册是一个异步的过程，在激活完成后当前页面的请求都已经发送完成，时机太晚。</p><p>实际请求速度：</p><ul><li>第 1 次进页面注册 serviceWorker - 请求速度无变化</li><li>第 2 次进页面 serviceWorker 拦截请求并且把请求缓存起来 - 请求速度无变化</li><li>第 3 次进页面 serviceWorker 拦截请求并直接使用上次的缓存 - 请求速度变快</li></ul><h3 id="安装激活" tabindex="-1"><a class="header-anchor" href="#安装激活" aria-hidden="true">#</a> 安装激活</h3><p><img src="https://pic3.zhimg.com/80/v2-bfbad3a9df7b6dc89a78a6bea8a8dff2_1440w.webp" alt="11.png"></p><h3 id="拦截请求" tabindex="-1"><a class="header-anchor" href="#拦截请求" aria-hidden="true">#</a> 拦截请求</h3><p><img src="https://pic1.zhimg.com/80/v2-252c3650c6128a70ba85853d70f964d0_1440w.webp" alt="12.png"></p><h3 id="缓存策略" tabindex="-1"><a class="header-anchor" href="#缓存策略" aria-hidden="true">#</a> 缓存策略</h3><p><img src="https://pic4.zhimg.com/80/v2-b9522602ba11f06d2c5827981b1445af_1440w.webp" alt="13.png"></p><h3 id="fetch-请求拦截" tabindex="-1"><a class="header-anchor" href="#fetch-请求拦截" aria-hidden="true">#</a> fetch 请求拦截</h3><p><img src="https://pic1.zhimg.com/80/v2-4b6a22b82669c035d661045902f474bc_1440w.webp" alt="14.png"></p><h3 id="serviceworker" tabindex="-1"><a class="header-anchor" href="#serviceworker" aria-hidden="true">#</a> serviceWorker</h3><p><img src="https://pic2.zhimg.com/80/v2-182f083320faea199592480d6404e0f5_1440w.webp" alt="1.png"></p><h3 id="cache-缓存" tabindex="-1"><a class="header-anchor" href="#cache-缓存" aria-hidden="true">#</a> cache 缓存</h3><p><img src="https://pic3.zhimg.com/80/v2-60a72599e7c27f44edf380b2aca28dba_1440w.webp" alt="2.png"></p><h3 id="缓存的资源" tabindex="-1"><a class="header-anchor" href="#缓存的资源" aria-hidden="true">#</a> 缓存的资源</h3><p><img src="https://pic1.zhimg.com/80/v2-4a006934ba6e10d0653e48593d3961c8_1440w.webp" alt="3.png"></p><h3 id="serviceworker-怎么更新" tabindex="-1"><a class="header-anchor" href="#serviceworker-怎么更新" aria-hidden="true">#</a> serviceWorker 怎么更新</h3><ol><li>下载</li></ol><ul><li>每次进入页面会重新下载 serviceWorker.js</li><li>每 24 小时必定会下载一次 serviceWorker.js（自定义计时器调 update() 可定期更新）</li><li>在 service worker 上的一个事件被触发并且过去 24 小时没有被下载会触发新的下载</li></ul><ol start="2"><li>安装更新</li></ol><ul><li>方法1：注册 path 地址的变更，navigator.serviceWorker.register(&#39;./sw.js?v=20190401235959&#39;)</li><li>方法2：下载后按照字节比对两次的 servicework.js，发现不一致就重新安装，修改版本标识更新</li></ul><ol start="3"><li>激活</li></ol><ul><li>第1次注册 serviceWorker 激活后，页面的请求不会通过 worker，只有在刷新页面后才会通过 serviceWorker 代理请求。</li><li>安装完毕后如果有旧版 serviceWorker 在运行，会进入 waiting 状态，直到不再有页面使用旧的 serviceWorker 才激活。可以使用 skipWaiting() 跳过等待直接激活。</li><li>使用 self.clients.claim() 可同步激活全部终端。</li><li>激活后可根据策略删除旧版缓存。</li></ul><h3 id="waituntil" tabindex="-1"><a class="header-anchor" href="#waituntil" aria-hidden="true">#</a> waitUntil()</h3><p>作用：延长生命周期事件的执行时间，等待传递的 Promise 被成功 resolve。</p><p>在 install 事件回调被调用时，它把即将被激活的 worker 线程状态延迟为 installing 状态，直到传递的 Promise 被成功地 resolve。作用：等待核心静态资源缓存完毕。</p><p>在 activate 事件回调被调用时，它把即将被激活的 worker 线程状态延迟为 activating 状态，直到传递的 Promise 被成功地 resolve。作用：删除过期的缓存条目。</p><p><img src="https://pic2.zhimg.com/80/v2-a6b116167fa9a8faad7fa4dea71d6b8d_1440w.webp" alt="17.png"></p><h3 id="skipwaiting" tabindex="-1"><a class="header-anchor" href="#skipwaiting" aria-hidden="true">#</a> skipWaiting()</h3><p>作用：同时打开多个网址，即存在多个终端。正常需要等所有的终端都关闭之后（全部关闭再新打开1个网站），才能激活新的 serviceWorker。如果不想等，检测到更新就直接激活新的 serviceWorker，用 skipWaiting。</p><p>风险：skipWaiting 意味着新 Service Worker 可能会控制使用较旧 serviceWorker 控制的页面。这意味着页面提取的部分数据将由旧 serviceWorker 处理，而新 serviceWorker 处理后来提取的数据。如果这会导致问题，则不要使用 skipWaiting()。</p><p>为什么用：监听 onload，时机很后面了，此次所有请求都由旧 serviceWorker 处理。但是我需要立马进入激活，让下次进来全部走新的（进入激活判断版本不一致删除缓存）。除非有需要否则一般不用更新。</p><h3 id="claim" tabindex="-1"><a class="header-anchor" href="#claim" aria-hidden="true">#</a> claim()</h3><p>问题：使用 skipWaiting 直接激活 serviceWorker，可能会出现其他终端还没有受当前终端激活的serviceWorker 控制的情况，切回其他终端之后，serviceWorker 控制页面的效果可能不符合预期。</p><p>解决：调用 self.clients.claim() 立马作用于 scope 内的所有终端。</p><p>为啥没用：不是都要加这个，要看是否有激活 serviceWorker 后马上控制所有终端的需要。</p><p>用法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
  self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><ol><li><p>serviceWorker 特性：异步独立线程，生命周期监听，请求拦截，缓存读写 API</p></li><li><p>网站资源缓存：</p></li></ol><ul><li>接口请求后端控制</li><li>浏览器自带缓存（图片资源）</li><li>html、js、css等资源请求通过 serviceWorker 控制</li></ul><ol start="3"><li>serviceWorker 缓存：</li></ol><ul><li>onload 里面执行注册</li><li>第3次刷新才会用到缓存加速</li><li>skipWaiting 跳过等待</li><li>serviceWorker 更新</li><li>document、外部依赖 sdk 先用缓存后更新，js、css、font 一直用缓存</li><li>检测是否支持：https://html5test.com</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/cjm0/blog.git/edit/master/docs/page/list/serviceWorker.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app.6da7124e.js" defer></script>
  </body>
</html>
